-- Core admin / billing / embeddings schema
CREATE OR REPLACE DATABASE IF NOT EXISTS AI_FEATURE_HUB;
USE DATABASE AI_FEATURE_HUB;
CREATE OR REPLACE SCHEMA IF NOT EXISTS DOCGEN;
USE SCHEMA DOCGEN;

CREATE OR REPLACE TABLE DOCGEN.ACCOUNTS (
  ACCOUNT_ID STRING PRIMARY KEY,
  ACCOUNT_NAME STRING,
  ADMIN_CONTACT_EMAIL STRING,
  INTEGRATION_KEY_HASH VARIANT,
  INTEGRATION_STATUS STRING,
  CREATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE DOCGEN.ACCOUNT_MARKUP (
  ACCOUNT_ID STRING,
  DEFAULT_MARKUP_PCT NUMBER(5,2),
  EFFECTIVE_FROM TIMESTAMP_LTZ,
  EFFECTIVE_TO TIMESTAMP_LTZ,
  UPDATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE DOCGEN.ACCOUNT_FEATURE_PRICING (
  ACCOUNT_ID STRING,
  FEATURE_KEY STRING,
  BASE_UNIT_PRICE NUMBER(18,6),
  UNIT STRING,
  MARKUP_PCT NUMBER(5,2),
  OVERRIDE_FLAG BOOLEAN,
  EFFECTIVE_FROM TIMESTAMP_LTZ,
  EFFECTIVE_TO TIMESTAMP_LTZ,
  UPDATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE DOCGEN.USAGE_EVENTS_STAGE (
  EVENT_ID STRING PRIMARY KEY,
  ACCOUNT_ID STRING,
  FEATURE_KEY STRING,
  UNITS NUMBER,
  RAW_EVENT VARIANT,
  RECEIVED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE DOCGEN.TENANT_FEATURE_USAGE (
  ACCOUNT_ID STRING,
  FEATURE_KEY STRING,
  USAGE_DATE DATE,
  USAGE_QTY NUMBER,
  PROVENANCE VARIANT,
  LAST_UPDATED TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE DOCGEN.BILLING_RUN (
  BILLING_RUN_ID STRING PRIMARY KEY,
  ACCOUNT_ID STRING,
  RUN_PERIOD_START DATE,
  RUN_PERIOD_END DATE,
  TOTAL_AMOUNT NUMBER(18,6),
  PREVIEW_HASH STRING,
  STATUS STRING,
  CREATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE DOCGEN.BILLING_LINE_ITEM (
  LINE_ITEM_ID STRING PRIMARY KEY,
  BILLING_RUN_ID STRING,
  ACCOUNT_ID STRING,
  FEATURE_KEY STRING,
  UNITS NUMBER,
  BASE_COST NUMBER(18,6),
  MARKUP_PCT NUMBER(5,2),
  MARKUP_AMOUNT NUMBER(18,6),
  TOTAL_COST NUMBER(18,6)
);

CREATE OR REPLACE TABLE DOCGEN.DOCUMENT_ARCHIVE (
  DOCUMENT_ID STRING PRIMARY KEY,
  TEMPLATE_ID STRING,
  ASSEMBLY_RUN_ID STRING,
  DOCUMENT_URL STRING,
  DOCUMENT_HASH STRING,
  CREATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP,
  CREATED_BY STRING,
  JURISDICTION STRING,
  RETENTION_TAG STRING
);

CREATE OR REPLACE TABLE DOCGEN.EVIDENCE_BUNDLE (
  BUNDLE_ID STRING PRIMARY KEY,
  DOCUMENT_ID STRING,
  ACCOUNT_ID STRING,
  ARCHIVE_LOCATION STRING,
  BUNDLE_HASH STRING,
  CREATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP,
  METADATA VARIANT
);

CREATE OR REPLACE TABLE DOCGEN.DOCUMENT_EMBEDDINGS (
  DOCUMENT_ID STRING,
  SECTION_ID STRING,
  EMBEDDING VARIANT,
  PROVENANCE VARIANT,
  METADATA VARIANT,
  CREATED_AT TIMESTAMP_LTZ DEFAULT CURRENT_TIMESTAMP
);

