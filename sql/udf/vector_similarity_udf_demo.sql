-- Demo UDF wrapper: prefer native engine then fallback to External Function
USE DATABASE AI_FEATURE_HUB;
USE SCHEMA DOCGEN;

CREATE OR REPLACE FUNCTION DOCGEN.SIMILARITY_FALLBACK(q VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
  -- Try native VECTOR UDF (if configured), else call external function
  SELECT
    CASE
      WHEN (SELECT COUNT(*) FROM INFORMATION_SCHEMA.FUNCTIONS WHERE FUNCTION_NAME = 'NATIVE_SIMILARITY' AND FUNCTION_SCHEMA = 'DOCGEN') > 0
      THEN (SELECT NATIVE_SIMILARITY(q))
      ELSE (SELECT DOCGEN.SIMILARITY_QUERY(q))
    END;
$$;

