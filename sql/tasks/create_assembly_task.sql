Purpose: Scheduled task to pick up completed DOCUMENT_ASSEMBLY_RUN entries and ensure evidence is zipped and exported for retention. @31 @70
USE DATABASE AI_FEATURE_HUB;
USE SCHEMA DOCGEN;
CREATE OR REPLACE TASK DOCGEN.TASK_PROCESS_ASSEMBLY WAREHOUSE = "COMPUTE_WH" SCHEDULE = 'USING CRON */5 * * * * UTC'
AS
INSERT INTO DOCGEN.ALERTS (ALERT_ID, ALERT_TYPE, PAYLOAD, SEVERITY)
SELECT 'alert_asm_' || LEFT(GENERATE_UUID(),8), 'ASSEMBLY_PENDING', OBJECT_CONSTRUCT('assembly_run_id', ASSEMBLY_RUN_ID), 'LOW'
FROM DOCGEN.DOCUMENT_ASSEMBLY_RUN
WHERE STATUS = 'IN_PROGRESS' AND CREATED_AT <= DATEADD('minute', -10, CURRENT_TIMESTAMP());

