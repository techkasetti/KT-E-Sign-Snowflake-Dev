-- Scheduled tasks (demo schedule & role)
USE DATABASE AI_FEATURE_HUB;
USE SCHEMA DOCGEN;

-- daily analytics task (runs at 02:00 UTC)
CREATE OR REPLACE TASK DOCGEN.TASK_RUN_SIGNATURE_ANALYTICS
  WAREHOUSE = "COMPUTE_WH"
  SCHEDULE = 'USING CRON 0 2 * * * UTC'
AS
CALL DOCGEN.RUN_SIGNATURE_ANALYTICS();

-- sample billing daily task (demo)
CREATE OR REPLACE TASK DOCGEN.TASK_DAILY_BILLING
  WAREHOUSE = "COMPUTE_WH"
  SCHEDULE = 'USING CRON 0 3 * * * UTC'
AS
-- Example: run preview for all accounts (demo pattern)
BEGIN
  FOR rec IN (SELECT DISTINCT ACCOUNT_ID FROM DOCGEN.ACCOUNTS)
  DO
    CALL DOCGEN.PREVIEW_BILLING(rec.ACCOUNT_ID, TO_CHAR(DATEADD('day', -30, CURRENT_DATE()), 'YYYY-MM-DD'), TO_CHAR(CURRENT_DATE(), 'YYYY-MM-DD'));
  END FOR;
END;

