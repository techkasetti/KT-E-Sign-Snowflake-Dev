CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_CLAUSE(clause_id STRING, name STRING, body CLOB, metadata VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.CLAUSE_LIBRARY t USING (SELECT :clause_id AS cid, :name AS nm, :body AS bd, :metadata AS md) s ON t.CLAUSE_ID = s.cid WHEN MATCHED THEN UPDATE SET NAME = s.nm, BODY = s.bd, METADATA = s.md WHEN NOT MATCHED THEN INSERT (CLAUSE_ID, NAME, BODY, METADATA) VALUES (s.cid, s.nm, s.bd, s.md);
$$

