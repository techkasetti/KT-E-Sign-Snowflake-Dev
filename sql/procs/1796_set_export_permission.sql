CREATE OR REPLACE PROCEDURE DOCGEN.SET_EXPORT_PERMISSION(account_id STRING, export_type STRING, allowed BOOLEAN)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.EXPORT_PERMISSIONS t USING (SELECT :account_id AS aid, :export_type AS et, :allowed AS a) s ON t.ACCOUNT_ID = s.aid AND t.EXPORT_TYPE = s.et WHEN MATCHED THEN UPDATE SET ALLOWED = s.a, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (PERM_ID, ACCOUNT_ID, EXPORT_TYPE, ALLOWED) VALUES (UUID_STRING(), s.aid, s.et, s.a);
$$;

