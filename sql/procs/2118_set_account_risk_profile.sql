CREATE OR REPLACE PROCEDURE DOCGEN.SET_ACCOUNT_RISK_PROFILE(account_id STRING, risk_level STRING, details VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.ACCOUNT_RISK_PROFILES t USING (SELECT :account_id AS aid, :risk_level AS rl, :details AS d) s ON t.ACCOUNT_ID = s.aid WHEN MATCHED THEN UPDATE SET RISK_LEVEL = s.rl, DETAILS = s.d, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (PROFILE_ID, ACCOUNT_ID, RISK_LEVEL, DETAILS) VALUES (UUID_STRING(), s.aid, s.rl, s.d);
$$

