CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_TEMPLATE_INTEGRATION_MAPPING(template_id STRING, integration_ref STRING, mapping_json VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.TEMPLATE_INTEGRATION_MAPPINGS t USING (SELECT :template_id AS tid, :integration_ref AS ir, :mapping_json AS mj) s ON t.TEMPLATE_ID = s.tid AND t.INTEGRATION_REF = s.ir WHEN MATCHED THEN UPDATE SET MAPPING_JSON = s.mj WHEN NOT MATCHED THEN INSERT (MAPPING_ID, TEMPLATE_ID, INTEGRATION_REF, MAPPING_JSON) VALUES (UUID_STRING(), s.tid, s.ir, s.mj);
$$
