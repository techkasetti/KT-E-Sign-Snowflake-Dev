CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_TEMPLATE_NOTIFICATION_PREF(template_id STRING, preferences VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.TEMPLATE_NOTIFICATION_PREFERENCES t USING (SELECT :template_id AS tid, :preferences AS prefs) s ON t.TEMPLATE_ID = s.tid WHEN MATCHED THEN UPDATE SET PREFERENCES = s.prefs, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (PREF_ID, TEMPLATE_ID, PREFERENCES) VALUES (UUID_STRING(), s.tid, s.prefs);
$$
