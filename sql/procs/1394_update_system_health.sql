CREATE OR REPLACE PROCEDURE DOCGEN.UPDATE_SYSTEM_HEALTH(component STRING, status STRING, details VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$ MERGE INTO DOCGEN.SYSTEM_HEALTH t USING (SELECT :component AS comp, :status AS st, :details AS d) s ON t.COMPONENT = s.comp WHEN MATCHED THEN UPDATE SET STATUS = s.st, DETAILS = s.d, CHECKED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (HEALTH_ID, COMPONENT, STATUS, DETAILS) VALUES (UUID_STRING(), s.comp, s.st, s.d); $$;

