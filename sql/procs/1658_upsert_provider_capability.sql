CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_PROVIDER_CAPABILITY(provider_id STRING, capability STRING, details VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.PROVIDER_CAPABILITIES t USING (SELECT :provider_id AS pid, :capability AS cap, :details AS d) s ON t.PROVIDER_ID = s.pid AND t.CAPABILITY = s.cap WHEN MATCHED THEN UPDATE SET DETAILS = s.d WHEN NOT MATCHED THEN INSERT (CAP_ID, PROVIDER_ID, CAPABILITY, DETAILS) VALUES (UUID_STRING(), s.pid, s.cap, s.d);
$$; 
-- @31 @24 @52

