CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_DEVICE_FINGERPRINT(device_id STRING, signer_id STRING, fp_hash STRING)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.DEVICE_FINGERPRINTS t USING (SELECT :device_id AS d, :signer_id AS s, :fp_hash AS h) src ON t.DEVICE_ID = src.d WHEN MATCHED THEN UPDATE SET FP_HASH = src.h WHEN NOT MATCHED THEN INSERT (FP_ID, DEVICE_ID, SIGNER_ID, FP_HASH) VALUES (UUID_STRING(), src.d, src.s, src.h);
$$;

