CREATE OR REPLACE PROCEDURE DOCGEN.COMPUTE_FEEDBACK_AGGREGATE(target_ref STRING)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
INSERT INTO DOCGEN.FEEDBACK_AGGREGATES (AGG_ID, TARGET_REF, AVG_RATING, COUNT)
SELECT UUID_STRING(), :target_ref, AVG(RATING), COUNT(*) FROM DOCGEN.USER_FEEDBACK WHERE TARGET_REF = :target_ref;
$$

