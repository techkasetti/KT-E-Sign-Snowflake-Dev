-- Aggregation stored-proc to roll-up events into metrics for reporting. @31 @24 @52
CREATE OR REPLACE PROCEDURE DOCGEN.AGG_SIGNATURE_EVENTS()
RETURNS VARIANT
LANGUAGE SQL
AS
$$
INSERT INTO DOCGEN.SIGNATURE_EVENT_METRICS (METRIC_DATE, ACCOUNT_ID, EVENT_TYPE, COUNT_EVENTS)
SELECT CAST(EVENT_TS AS DATE), ACCOUNT_ID, EVENT_TYPE, COUNT(*) FROM DOCGEN.SIGNATURE_EVENTS
GROUP BY CAST(EVENT_TS AS DATE), ACCOUNT_ID, EVENT_TYPE;
$$;

