CREATE OR REPLACE PROCEDURE DOCGEN.PUT_METADATA_KV(entity_ref STRING, k STRING, v VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.METADATA_KV t USING (SELECT :entity_ref AS er, :k AS key, :v AS val) s ON t.ENTITY_REF = s.er AND t.K = s.key WHEN MATCHED THEN UPDATE SET V = s.val WHEN NOT MATCHED THEN INSERT (KV_ID, ENTITY_REF, K, V) VALUES (UUID_STRING(), s.er, s.key, s.val);
$$; 
-- @31 @24 @52

