CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_RECIPIENT_PREFERENCE_07(pref_id STRING, recipient_ref STRING, channels ARRAY)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.RECIPIENT_PREFERENCES_07 t USING (SELECT :pref_id AS pid, :recipient_ref AS rr, :channels AS ch) s ON t.PREF_ID = s.pid WHEN MATCHED THEN UPDATE SET RECIPIENT_REF = s.rr, CHANNELS = s.ch, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (PREF_ID, RECIPIENT_REF, CHANNELS) VALUES (s.pid, s.rr, s.ch);
$$

