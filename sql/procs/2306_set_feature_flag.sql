CREATE OR REPLACE PROCEDURE DOCGEN.SET_FEATURE_FLAG(flag_name STRING, enabled BOOLEAN, meta VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.FEATURE_FLAGS t USING (SELECT :flag_name AS fn, :enabled AS en, :meta AS m) s ON t.FLAG_NAME = s.fn WHEN MATCHED THEN UPDATE SET ENABLED = s.en, META = s.m, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (FLAG_NAME, ENABLED, META) VALUES (s.fn, s.en, s.m);
$$;

