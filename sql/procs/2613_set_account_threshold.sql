CREATE OR REPLACE PROCEDURE DOCGEN.SET_ACCOUNT_THRESHOLD(account_id STRING, metric_name STRING, threshold_value NUMBER, notify BOOLEAN)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.ACCOUNT_THRESHOLDS t USING (SELECT :account_id AS aid, :metric_name AS mn, :threshold_value AS tv, :notify AS nt) s ON t.ACCOUNT_ID = s.aid AND t.METRIC_NAME = s.mn WHEN MATCHED THEN UPDATE SET THRESHOLD_VALUE = s.tv, NOTIFY = s.nt WHEN NOT MATCHED THEN INSERT (THRESHOLD_ID, ACCOUNT_ID, METRIC_NAME, THRESHOLD_VALUE, NOTIFY) VALUES (UUID_STRING(), s.aid, s.mn, s.tv, s.nt);
$$

