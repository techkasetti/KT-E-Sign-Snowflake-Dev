CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_SUPPORT_KB_ARTICLE(article_id STRING, title STRING, body CLOB)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.SUPPORT_KB_ARTICLES t USING (SELECT :article_id AS aid, :title AS ttl, :body AS bd) s ON t.ARTICLE_ID = s.aid WHEN MATCHED THEN UPDATE SET TITLE = s.ttl, BODY = s.bd, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (ARTICLE_ID, TITLE, BODY) VALUES (s.aid, s.ttl, s.bd);
$$

