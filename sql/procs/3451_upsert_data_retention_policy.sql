CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_DATA_RETENTION_POLICY(policy_id STRING, name STRING, retention_days INT, archive_before BOOLEAN, enabled BOOLEAN)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.DATA_RETENTION_POLICIES t USING (SELECT :policy_id AS pid, :name AS nm, :retention_days AS rd, :archive_before AS ab, :enabled AS en) s ON t.POLICY_ID = s.pid WHEN MATCHED THEN UPDATE SET NAME = s.nm, RETENTION_DAYS = s.rd, ARCHIVE_BEFORE = s.ab, ENABLED = s.en WHEN NOT MATCHED THEN INSERT (POLICY_ID, NAME, RETENTION_DAYS, ARCHIVE_BEFORE, ENABLED) VALUES (s.pid, s.nm, s.rd, s.ab, s.en);
$$

