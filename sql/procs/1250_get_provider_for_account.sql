-- Resolve provider choice for a given account/request (canary or priority-based routing). @31 @24 @52
CREATE OR REPLACE PROCEDURE DOCGEN.GET_PROVIDER_FOR_ACCOUNT(account_id STRING)
RETURNS VARIANT
LANGUAGE SQL
AS
$$ SELECT OBJECT_AGG(PROVIDER_ID, PARSE_JSON(OBJECT_CONSTRUCT(*))) FROM DOCGEN.SIGNATURE_PROVIDER_CONFIG WHERE ACCOUNT_ID = :account_id ORDER BY PRIORITY;
$$;

