CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_DATA_MASKING_RULE(name STRING, scope VARIANT, mask_expr STRING, enabled BOOLEAN)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.DATA_MASKING_RULES t USING (SELECT :name AS nm, :scope AS sc, :mask_expr AS me, :enabled AS en) s ON t.NAME = s.nm WHEN MATCHED THEN UPDATE SET SCOPE = s.sc, MASK_EXPR = s.me, ENABLED = s.en WHEN NOT MATCHED THEN INSERT (RULE_ID, NAME, SCOPE, MASK_EXPR, ENABLED) VALUES (UUID_STRING(), s.nm, s.sc, s.me, s.en);
$$

