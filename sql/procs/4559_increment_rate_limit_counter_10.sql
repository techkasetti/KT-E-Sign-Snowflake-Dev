CREATE OR REPLACE PROCEDURE DOCGEN.INCREMENT_RATE_LIMIT_COUNTER_10(counter_id STRING, rule_id STRING, key STRING, delta INT, window_start TIMESTAMP_LTZ, window_end TIMESTAMP_LTZ)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.RATE_LIMIT_COUNTERS_10 t USING (SELECT :counter_id AS cid, :rule_id AS rid, :key AS k, :delta AS d, :window_start AS ws, :window_end AS we) s ON t.COUNTER_ID = s.cid WHEN MATCHED THEN UPDATE SET COUNT = COALESCE(COUNT,0)+s.d, WINDOW_START = s.ws, WINDOW_END = s.we WHEN NOT MATCHED THEN INSERT (COUNTER_ID, RULE_ID, KEY, COUNT, WINDOW_START, WINDOW_END) VALUES (s.cid, s.rid, s.k, s.d, s.ws, s.we);
$$

