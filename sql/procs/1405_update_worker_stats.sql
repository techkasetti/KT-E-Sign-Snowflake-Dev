CREATE OR REPLACE PROCEDURE DOCGEN.UPDATE_WORKER_STATS(worker_id STRING, jobs_run INT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$ MERGE INTO DOCGEN.WORKER_STATS t USING (SELECT :worker_id AS w, :jobs_run AS j) s ON t.WORKER_ID = s.w WHEN MATCHED THEN UPDATE SET JOBS_RUN = t.JOBS_RUN + s.j, LAST_RUN_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (WORKER_ID, JOBS_RUN, LAST_RUN_AT) VALUES (s.w, s.j, CURRENT_TIMESTAMP()); $$;

