CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_USER_PREFERENCE_04(pref_id STRING, user_ref STRING, preferences VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.USER_PREFERENCES_04 t USING (SELECT :pref_id AS pid, :user_ref AS ur, :preferences AS prefs) s ON t.PREF_ID = s.pid WHEN MATCHED THEN UPDATE SET USER_REF = s.ur, PREFERENCES = s.prefs, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (PREF_ID, USER_REF, PREFERENCES) VALUES (s.pid, s.ur, s.prefs);
$$

