CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_DEVICE_FINGERPRINT_11(fp_id STRING, signer_id STRING, device_meta VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.DEVICE_FINGERPRINTS_11 t USING (SELECT :fp_id AS fid, :signer_id AS sid, :device_meta AS dm) s
ON t.FINGERPRINT_ID = s.fid
WHEN MATCHED THEN UPDATE SET SIGNER_ID = s.sid, DEVICE_META = s.dm, LAST_SEEN = CURRENT_TIMESTAMP()
WHEN NOT MATCHED THEN INSERT (FINGERPRINT_ID, SIGNER_ID, DEVICE_META) VALUES (s.fid, s.sid, s.dm);
$$

