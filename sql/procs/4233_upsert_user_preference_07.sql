CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_USER_PREFERENCE_07(pref_id STRING, user_ref STRING, pref_key STRING, pref_value VARIANT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.USER_PREFERENCES_07 t USING (SELECT :pref_id AS pid, :user_ref AS ur, :pref_key AS pk, :pref_value AS pv) s ON t.PREF_ID = s.pid WHEN MATCHED THEN UPDATE SET PREF_KEY = s.pk, PREF_VALUE = s.pv, UPDATED_AT = CURRENT_TIMESTAMP() WHEN NOT MATCHED THEN INSERT (PREF_ID, USER_REF, PREF_KEY, PREF_VALUE) VALUES (s.pid, s.ur, s.pk, s.pv);
$$

