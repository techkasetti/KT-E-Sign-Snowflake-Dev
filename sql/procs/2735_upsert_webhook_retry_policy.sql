CREATE OR REPLACE PROCEDURE DOCGEN.UPSERT_WEBHOOK_RETRY_POLICY(name STRING, schedule VARIANT, max_attempts INT)
RETURNS VARIANT
LANGUAGE SQL
AS
$$
MERGE INTO DOCGEN.WEBHOOK_RETRY_POLICIES t USING (SELECT :name AS nm, :schedule AS sch, :max_attempts AS ma) s ON t.NAME = s.nm WHEN MATCHED THEN UPDATE SET SCHEDULE = s.sch, MAX_ATTEMPTS = s.ma WHEN NOT MATCHED THEN INSERT (POLICY_ID, NAME, SCHEDULE, MAX_ATTEMPTS) VALUES (UUID_STRING(), s.nm, s.sch, s.ma);
$$

