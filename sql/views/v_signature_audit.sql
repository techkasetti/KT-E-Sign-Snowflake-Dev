Purpose: Admin view that composes signature events, validation status, evidence bundle linkage and PKI/OCSP status for fast audit lookups. @113 @514
-- v_signature_audit.sql
USE DATABASE AI_FEATURE_HUB;
USE SCHEMA DOCGEN;
CREATE OR REPLACE VIEW DOCGEN.V_SIGNATURE_AUDIT AS
SELECT se.EVENT_ID, se.EVENT_TYPE, se.EVENT_TS, se.REQUEST_ID, sr.ACCOUNT_ID, s.SIGNER_NAME, sv.VALIDATION_STATUS, sv.VALIDATION_HASH, eb.BUNDLE_ID, eb.ARCHIVE_LOCATION, p.STATUS AS OCSP_STATUS
FROM DOCGEN.SIGNATURE_EVENTS se
LEFT JOIN DOCGEN.SIGNATURE_REQUESTS sr ON sr.REQUEST_ID = se.REQUEST_ID
LEFT JOIN DOCGEN.SIGNERS s ON s.SIGNER_ID = se.SIGNER_ID
LEFT JOIN DOCGEN.SIGNATURE_VALIDATION sv ON sv.REQUEST_ID = se.REQUEST_ID AND sv.SIGNER_ID = se.SIGNER_ID
LEFT JOIN DOCGEN.EVIDENCE_BUNDLE eb ON eb.DOCUMENT_ID = sr.DOCUMENT_ID
LEFT JOIN DOCGEN.PKI_OCSP_STATUS p ON p.CERT_FINGERPRINT = sv.SIGNER_CERT_FINGERPRINT
ORDER BY se.EVENT_TS DESC;

